version: "3"

tasks:
  default:
    desc: Run all tests
    cmds:
      - task: unit
  watch:
    desc: Run unit tests with auto-reload
    cmds:
      - task: unit:watch

  # Unit Tests

  unit:
    desc: Run unit tests
    interactive: true
    cmds:
      - mocha --config ./config/tests/unit/mocharc.js

  unit:watch:
    desc: Run unit tests with auto-reload
    interactive: true
    cmds:
      - mocha --config ./config/tests/unit/mocharc.js --watch --reporter nyan

  unit:cover:
    desc: Run unit test and generate coverage
    interactive: true
    cmds:
      - nyc --nycrc-path ./config/tests/unit/nyc.cli.config.js mocha --config ./config/tests/unit/mocharc.js
  unit:report:json:
    desc: Generate unit test test report in JSON
    ignore_error: true
    cmds:
      - mocha --config ./config/tests/unit/mocharc.json.js
  unit:report:html:
    desc: Generate unit test test report in HTML
    ignore_error: true
    cmds:
      - mocha --config ./config/tests/unit/mocharc.html.js
  unit:report:cover:
    desc: Generate unit test coverage reports
    cmds:
      - nyc --nycrc-path ./config/tests/unit/nyc.report.config.js mocha --config ./config/tests/unit/mocharc.js
  unit:report:
    desc: Generate all unit test related reports
    deps:
      - unit:report:json
      - unit:report:html
    cmds:
      - task: unit:report:cover

  # Integration tests
  int:
    desc: Run integration tests
    interactive: true
    cmds:
      - mocha --config ./config/tests/integration/mocharc.js

  int:watch:
    desc: Run integration tests with auto-reload
    interactive: true
    cmds:
      - mocha --config ./config/tests/integration/mocharc.js --watch --reporter nyan

  int:cover:
    desc: Run integration test and generate coverage
    interactive: true
    cmds:
      - nyc --nycrc-path ./config/tests/integration/nyc.cli.config.js mocha --config ./config/tests/integration/mocharc.js
  int:report:json:
    desc: Generate integration test test report in JSON
    ignore_error: true
    cmds:
      - mocha --config ./config/tests/integration/mocharc.json.js
  int:report:html:
    desc: Generate unit test test report in HTML
    ignore_error: true
    cmds:
      - mocha --config ./config/tests/integration/mocharc.html.js
  int:report:cover:
    desc: Generate unit test coverage reports
    cmds:
      - nyc --nycrc-path ./config/tests/integration/nyc.report.config.js mocha --config ./config/tests/unit/mocharc.js
  int:report:
    desc: Generate all integration test related reports
    deps:
      - int:report:json
      - int:report:html
    cmds:
      - task: int:report:cover

  # util
  clean:
    desc: Cleans up ephemeral test artifacts
    ignore_error: true
    cmds:
      - rm -rf test-results
      - rm -rf .nyc_output
      - rm -rf coverage
